FROM node:22-bookworm

# System deps (Python do testów, Git, curl, certy)
RUN apt-get update -o Acquire::Retries=3 -o Acquire::http::Timeout="60" && \
    apt-get install -y --no-install-recommends \
      git openssh-client ripgrep \
      python3 python3-pip python3-venv ca-certificates curl && \
    rm -rf /var/lib/apt/lists/*

# Codex CLI (globalnie)
RUN npm i -g @openai/codex@latest

ENV CODEX_HOME=/root/.codex
WORKDIR /workspace

# Sensowne domyślne ustawienia gita (bezpieczne katalogi, gałąź domyślna)
RUN git config --global init.defaultBranch main \
 && git config --global pull.rebase false \
 && git config --global advice.detachedHead false \
 && git config --global --add safe.directory '*' 
